# EventTracker - Kotlin Multiplatform 项目规则

## 项目概述
这是一个 Kotlin Multiplatform (KMP) 项目，使用 Compose Multiplatform 构建跨平台 UI，使用 Ktor 作为服务器框架。

### 技术栈
- **语言**: Kotlin 2.2.20
- **UI 框架**: Compose Multiplatform 1.9.1
- **服务器**: Ktor 3.3.1
- **构建工具**: Gradle with Kotlin DSL
- **包名**: `mingsin.event`

### 支持的平台
- Android (minSdk 24, targetSdk 36)
- iOS (Arm64, SimulatorArm64)
- Desktop (JVM)
- Web (JS, WasmJS)
- Server (JVM)

## 代码风格和约定

### Kotlin 编码规范
- 遵循 Kotlin 官方编码规范
- 使用 4 个空格缩进（不使用 Tab）
- 类名使用 PascalCase
- 函数和变量名使用 camelCase
- 常量使用 UPPER_SNAKE_CASE
- 优先使用 `val` 而非 `var`
- 优先使用表达式函数体：`fun greet() = "Hello"`
- 使用数据类存储数据：`data class Event(...)`
- 使用密封类/接口处理状态：`sealed class UiState`

### Compose 最佳实践
- 使用 `@Composable` 函数构建 UI
- 遵循单向数据流原则
- 使用 `remember` 和 `mutableStateOf` 管理本地状态
- 使用 `ViewModel` 管理业务逻辑和状态（通过 `lifecycle-viewmodel-compose`）
- 使用 Material3 设计系统
- 为可组合函数添加 `@Preview` 注解以便预览
- 使用 `Modifier` 链式调用，按以下顺序：
  1. 布局相关（size, fillMaxSize, etc.）
  2. 安全相关（safeContentPadding, etc.）
  3. 视觉相关（background, padding, etc.）
  4. 交互相关（clickable, etc.）

### 文件结构约定
- **composeApp/**: Compose Multiplatform 应用代码
  - `commonMain/`: 所有平台共享的代码
  - `androidMain/`: Android 特定代码
  - `iosMain/`: iOS 特定代码
  - `jvmMain/`: Desktop 特定代码
  - `webMain/`: Web 特定代码
- **server/**: Ktor 服务器应用代码
- **shared/**: 所有目标平台共享的业务逻辑代码
  - `commonMain/`: 共享代码
  - 平台特定文件夹用于平台特定实现

### 多平台开发规则
- 优先将代码放在 `commonMain` 中，除非需要平台特定实现
- 使用 `expect/actual` 机制处理平台差异
- 平台特定代码放在对应的源集文件夹中（如 `androidMain`, `iosMain`）
- 共享的业务逻辑放在 `shared` 模块
- UI 代码放在 `composeApp` 模块

### 依赖管理
- 使用 `gradle/libs.versions.toml` 统一管理版本
- 新依赖添加到 `libs.versions.toml` 的 `[libraries]` 部分
- 插件版本在 `[versions]` 和 `[plugins]` 部分管理
- 使用版本目录引用：`libs.ktor.serverCore`

### 服务器开发 (Ktor)
- 使用 Ktor 的 DSL 风格路由
- 将路由逻辑组织到独立的函数中
- 使用依赖注入管理服务
- 遵循 RESTful API 设计原则
- 使用适当的 HTTP 状态码

### 命名约定
- 可组合函数：使用 PascalCase，如 `EventList()`, `EventCard()`
- ViewModel：以 `ViewModel` 结尾，如 `EventViewModel`
- 数据类：使用名词，如 `Event`, `User`
- 接口：使用形容词或名词，如 `EventRepository`, `EventService`
- 工具函数：使用动词开头，如 `formatDate()`, `validateInput()`

### 错误处理
- 使用 Kotlin 的 Result 类型处理可能失败的操作
- 使用密封类表示错误状态：`sealed class Result<out T>`
- 在 UI 中优雅地处理错误状态
- 使用 try-catch 处理异常，并提供有意义的错误消息

### 测试
- 为业务逻辑编写单元测试
- 使用 `kotlin-test` 进行测试
- 测试文件放在对应的 `test` 源集中

### 性能优化
- 使用 `remember` 缓存计算结果
- 使用 `LazyColumn`/`LazyRow` 处理长列表
- 避免在可组合函数中进行重计算
- 使用 `derivedStateOf` 优化派生状态

### 代码组织
- 按功能模块组织代码，而非按类型
- 每个功能模块包含：UI、ViewModel、Repository、Model
- 使用包结构反映功能模块：`mingsin.event.feature.eventlist`

### 注释和文档
- 为公共 API 添加 KDoc 注释
- 使用 `@param` 和 `@return` 标签
- 为复杂的业务逻辑添加行内注释
- 保持注释与代码同步

### Git 提交
- 提交信息使用中文或英文，保持清晰
- 遵循约定式提交格式（可选但推荐）

## 禁止事项
- 不要在 `commonMain` 中导入平台特定的库
- 不要使用 Java 风格的 getter/setter，使用 Kotlin 属性
- 不要在可组合函数中直接调用挂起函数
- 不要忽略编译器警告
- 不要硬编码字符串，使用资源文件或常量

## 响应语言
- 始终使用中文简体回复用户

